# 代码逻辑和理解逻辑

法国人的代码写的很烂，而且很多代码逻辑和理解逻辑冲突。所有冲突均以理解逻辑为准。

# 满仓和无原料的细节设定

正确理解：“仓储为nsmax-1时触发了事件5”会使状态变为满仓。

注意法国人最后一次上课讲的几个例题互相矛盾。流程图表明“仓储为nsmax时触发了事件5”会使状态变为满仓，虽然这个逻辑其实是他写代码的逻辑，但是还是上文的正确理解更符合人类认知习惯。

“箱子1仓储为0时，机器2发生了事件5”会使机器2会变为“无原料”状态。事件5其实可以认为是发生了两件事，其一是生产了一个产品，其二是拿走一个半成品。若机器2发生事件5时，箱子1还有1个半成品，那机器2还是会正常获得一个原料，所以不会改变状态。

# 流程图画法

状态也是一个变量，它的特殊之处在于，它的取值是有限枚举且循环的，因此用它来画流程图。

若把“时间流逝至下一个普通事件发生”视为一个“上帝事件”，那么当且仅当发生一次事件，变量矩阵才会变化一次。

当机器状态为黑圆所示，且各变量如蓝色表达式所示时，发生了红字所示事件，则机器状态变为事件对应箭头指向的黑圆

# 串行双机器

状态45“半成品满仓，机器2无半成品原料”自相矛盾，永不成立

## 生产中和满仓的转换

- 41（机器1满仓，机器2生产中）→44（两个机器都满仓）
  - 只有可能是因为在ns2=nsmax2-1时，机器2触发了事件52，生产了一个产品
  - 先结算满仓状态，因此机器2不再生产
  - 所以本轮事件中不再执行“拿取一个半成品”这一步，从而保持了机器1的满仓状态
- 44（两个机器都满仓）→41（机器1满仓，机器2生产中）
  - 触发事件6，改变了箱子2的储量。接着，事件52的下一次触发时间变为Umax2，最后机器2的状态切换为生产中
  - 本来只有事件52才有权更改箱子1的储量，事件6则不能，所以机器1的状态保持为满仓
  - 因此虽然机器2已经开始生产了，但本次生产并没有拿原料，这是自相矛盾的
  - 矛盾的核心在于，法国人不认为机器2的“拿原料”是单独的事件
  - 若事件6内部触发了机器2的“拿原料”事件，则违反了“同时只能发生一个事件”的原则
  - 综上，我们强行规定，“44变换为41”这一变化中，机器2开始的生产不需要原料，这样就避免了破坏原有体系
- 41（机器1满仓，机器2生产中）→11（两个机器都在生产中）
  - 如上所述，事件52可导致该状态变化

# 题目

法国人只讲了串行双机器的题目

## ex1

![](img/class_notes/1.jpg)

问生产中和满仓的转换。

我们默认“44变换为41”这一变化中，机器2开始的生产不需要原料，使得该系统按照法国人的逻辑运行

## ex2.1

![](img/class_notes/2-1.jpg)

给定变量矩阵作为初始条件

- 要求判断下一个事件是何事件
- 问发生该事件后机器状态变成什么样
- 不要求得出事件发生后的变量矩阵

## ex2.2

![](img/class_notes/2-2.jpg)

修改了变量矩阵，得到新的结果

## ex2.3

![](img/class_notes/2-3.jpg)

修改了变量矩阵，得到新的结果

## ex4

![](img/class_notes/4.jpg)

辨析状态15和状态45的关系

前面提到了状态45自相矛盾。保持状态15的条件是机器1生产得快而机器2生产得慢。当箱子1为空，且机器1正在生产中时，机器2触发事件52，则变换到状态15

结论是：状态15永远无法变为状态45

## ex5

![](img/class_notes/5.jpg)

题目是流程图，需要同时考虑机器状态和其他变量

- 不知道他会给什么条件，又要填什么
- 注意参考流程图画法
- 自己做题时，“大于、小于、大于等于、小于等于”一定要注意，法国人上课写的可以错，我们考试写的不能错

## 状态转换表

按照涂色Excel表格所示的图形背表格，以备不时之需

# 总结

本课程需要

- 理解事件、变量和机器状态三者的编程定义
- 背熟每个事件和状态的编号对应的含义
- 最好背熟每个常量
- 能够手动计算发生1-2个事件之后的机器状态
- 能够理解机器状态是如何转换的，并至少会背串联的状态转换表

